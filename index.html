<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>クイズアプリ</title>
    <!-- Tailwind CSSを読み込み -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* 基本的なスタイル設定 */
        body {
            font-family: 'Helvetica Neue', 'Arial', 'Hiragino Kaku Gothic ProN', 'Hiragino Sans', 'Meiryo', sans-serif;
        }
        /* 各画面の表示・非表示を制御 */
        .screen { display: none; }
        .screen.active { display: block; }

        /* 画像プレビューのスタイル */
        .image-preview {
            width: 150px;
            height: 150px;
            object-fit: cover;
            border-radius: 0.5rem;
            background-color: #e5e7eb; /* gray-200 */
        }
        .form-image-preview {
            width: 64px;
            height: 64px;
            object-fit: cover;
            border-radius: 0.25rem;
            border: 1px solid #d1d5db; /* gray-300 */
             background-color: #f3f4f6; /* gray-100 */
        }
        
        /* 選択肢ボタンのスタイル */
        .choice-btn { transition: all 0.3s ease; }
        /* --- 修正点：正解は緑の枠線、不正解は塗りつぶしなしに --- */
        .correct {
            border-color: #22c55e !important; /* green-500 */
            border-width: 3px !important;
            background-color: white !important;
            color: #374151 !important; /* text-gray-700 */
        }
        .incorrect {
            background-color: white !important;
            color: #374151 !important; /* text-gray-700 */
            border-color: #d1d5db !important; /* gray-300 */
            opacity: 0.7;
        }

        /* ローディングオーバーレイ */
        #loader {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-color: rgba(0, 0, 0, 0.5); display: none;
            justify-content: center; align-items: center; z-index: 9999;
        }
        .spinner {
            border: 8px solid #f3f3f3; border-top: 8px solid #3498db;
            border-radius: 50%; width: 60px; height: 60px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* カスタムアラート */
        #custom-alert {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-color: rgba(0, 0, 0, 0.5); display: none;
            justify-content: center; align-items: center; z-index: 9998;
        }
        #custom-alert-box {
            background: white; padding: 2rem; border-radius: 1rem; text-align: center;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1); max-width: 90%; width: 400px;
            white-space: pre-wrap; /* 改行を有効にする */
        }
    </style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen">

    <div class="container mx-auto p-4 max-w-2xl bg-white rounded-2xl shadow-lg">
        <!-- トップ画面 -->
        <div id="home-screen" class="screen active text-center p-8">
            <h1 class="text-4xl font-bold mb-12 text-gray-800">クイズつくろう</h1>
            <div class="space-y-6">
                <button id="go-to-create-btn" class="w-full bg-blue-500 text-white font-bold py-4 px-6 rounded-lg hover:bg-blue-600 transition duration-300 text-xl shadow-md">
                    クイズを作る
                </button>
                 <!-- --- 修正点：編集ボタンを追加 --- -->
                <div class="flex items-center border-2 border-gray-300 rounded-lg focus-within:ring-2 focus-within:ring-blue-500 focus-within:border-transparent">
                    <input type="text" id="quiz-name-input" placeholder="クイズ名を入力" class="w-full p-4 border-0 rounded-l-lg focus:ring-0 text-lg">
                    <div class="flex p-1">
                        <button id="start-quiz-btn" class="bg-green-500 text-white font-bold py-3 px-4 rounded-lg hover:bg-green-600 transition duration-300 text-base shadow-md whitespace-nowrap">
                            挑戦する
                        </button>
                        <button id="edit-quiz-btn" class="ml-2 bg-yellow-500 text-white font-bold py-3 px-4 rounded-lg hover:bg-yellow-600 transition duration-300 text-base shadow-md whitespace-nowrap">
                            編集する
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- クイズ作成画面 -->
        <div id="create-screen" class="screen p-6">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-3xl font-bold text-gray-800">クイズ作成</h2>
                <button id="back-to-home-from-create" class="bg-gray-200 text-gray-700 font-bold py-2 px-4 rounded-lg hover:bg-gray-300 transition duration-300">戻る</button>
            </div>
            <input type="text" id="quiz-title-input" placeholder="クイズのタイトル" class="w-full border-2 border-gray-300 p-3 mb-6 rounded-lg text-lg">
            
            <div id="questions-container" class="space-y-8">
                <!-- 問題入力フォームはJSでここに追加されます -->
            </div>

            <!-- --- 修正点：クイズ削除ボタンをテキストに変更し、下に配置 --- -->
            <div>
                <div class="mt-8 flex space-x-4">
                    <button id="add-question-btn" class="w-full bg-blue-500 text-white font-bold py-3 px-6 rounded-lg hover:bg-blue-600 transition duration-300">問題を追加</button>
                    <button id="save-quiz-btn" class="w-full bg-green-500 text-white font-bold py-3 px-6 rounded-lg hover:bg-green-600 transition duration-300">クイズを保存</button>
                </div>
                <div class="mt-2 text-right">
                    <button id="delete-quiz-btn" class="text-gray-500 text-xs font-medium hover:text-red-600 hover:underline transition-colors duration-200">このクイズを削除</button>
                </div>
            </div>
        </div>

        <!-- クイズ実行画面 -->
        <div id="play-screen" class="screen p-6 relative">
             <button id="back-to-home-from-play" class="absolute top-4 right-4 text-xs font-light text-gray-400 hover:text-gray-600 transition">クイズ終了</button>
             <h2 id="quiz-title-display" class="text-left text-sm font-normal text-gray-500 mb-12"></h2>
             <div id="question-area" class="text-center">
                 <img id="question-image" src="" alt="問題の画像" class="mx-auto mb-4 rounded-lg shadow-md max-h-60" style="display:none;" >
                 <p id="question-text" class="text-2xl font-semibold mb-8 text-gray-800 min-h-[3rem]"></p>
                 <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                     <button id="choice-a-btn" data-choice="A" class="choice-btn w-full border-2 border-blue-400 p-4 rounded-lg hover:bg-blue-100 transition duration-300 bg-white">
                         <img id="choice-a-image" src="" alt="選択肢Aの画像" class="mx-auto mb-2 image-preview" style="display:none;">
                         <span id="choice-a-text" class="text-xl font-medium text-gray-700"></span>
                     </button>
                     <button id="choice-b-btn" data-choice="B" class="choice-btn w-full border-2 border-blue-400 p-4 rounded-lg hover:bg-blue-100 transition duration-300 bg-white">
                         <img id="choice-b-image" src="" alt="選択肢Bの画像" class="mx-auto mb-2 image-preview" style="display:none;">
                         <span id="choice-b-text" class="text-xl font-medium text-gray-700"></span>
                     </button>
                 </div>
                 <div id="result-area" class="mt-6 text-center">
                     <p id="result-message" class="text-4xl font-bold"></p>
                     <button id="next-question-btn" class="mt-4 bg-yellow-500 text-white font-bold py-3 px-8 rounded-lg hover:bg-yellow-600 transition duration-300 text-lg hidden">次の問題へ</button>
                 </div>
             </div>
        </div>
    </div>

    <!-- ローディング表示 -->
    <div id="loader"><div class="spinner"></div></div>

    <!-- カスタムアラート -->
    <div id="custom-alert">
        <div id="custom-alert-box">
            <p id="custom-alert-message" class="mb-6 text-lg"></p>
            <button id="custom-alert-ok" class="bg-blue-500 text-white font-bold py-2 px-8 rounded-lg hover:bg-blue-600">OK</button>
        </div>
    </div>

    <script type="module">
        // Firebase SDKのインポート
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        // --- 修正点：deleteDocをインポート ---
        import { getFirestore, collection, query, where, getDocs, setDoc, doc, deleteDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // --- あなたのFirebaseプロジェクトの設定情報 ---
        const firebaseConfig = {
            apiKey: "AIzaSyA5b_BSc9I5uQq-v8bW1NHWJ54cFUlu_sE",
            authDomain: "quiz-gemini-f7b63.firebaseapp.com",
            projectId: "quiz-gemini-f7b63",
            storageBucket: "quiz-gemini-f7b63.appspot.com",
            messagingSenderId: "335663897113",
            appId: "1:335663897113:web:ef415c6d24f3aae695e888",
            measurementId: "G-MJVBVDNYL8"
        };

        const appId = "quiz-app"; // 任意のアプリID
        
        // Firebaseの初期化
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        let userId = null;
        let currentQuiz = null;
        let currentQuestionIndex = 0;

        // --- UI制御関数 ---
        const loader = document.getElementById('loader');
        const customAlert = document.getElementById('custom-alert');
        const showLoader = (show) => { loader.style.display = show ? 'flex' : 'none'; };
        const showAlert = (message) => {
            document.getElementById('custom-alert-message').textContent = message;
            customAlert.style.display = 'flex';
        };
        document.getElementById('custom-alert-ok').addEventListener('click', () => {
            customAlert.style.display = 'none';
        });
        const showScreen = (screenId) => {
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.toggle('active', screen.id === screenId);
            });
        };
        
        function disableApp(message) {
            const homeScreen = document.getElementById('home-screen');
            homeScreen.innerHTML = `
                <div class="p-8 text-center text-red-600 bg-red-50 rounded-lg">
                    <h2 class="text-2xl font-bold mb-4">アプリ エラー</h2>
                    <p class="text-left whitespace-pre-wrap">${message}</p>
                </div>`;
            showScreen('home-screen');
        }

        // --- メイン処理 ---
        document.addEventListener('DOMContentLoaded', () => {
            onAuthStateChanged(auth, user => {
                if (user) {
                    userId = user.uid;
                }
            });
            
            signInAnonymously(auth).catch(error => {
                console.error("Firebase Anonymous Sign-In Error:", error);
                let errorMessage = `Firebaseへの接続中に予期せぬエラーが発生しました:\n${error.message}`;
                if (error.code === 'auth/configuration-not-found') {
                     errorMessage = '【Firebase認証エラー】\n\n' +
                                     '匿名サインインが有効になっていません。\n\n' +
                                     '【解決策】\nFirebaseコンソールの「Authentication」設定で、「Sign-in method」タブから「匿名」プロバイダを有効にしてください。';
                }
                disableApp(errorMessage);
            });

            setupEventListeners();
        });
        
        // --- イベントリスナー設定 ---
        function setupEventListeners() {
            document.getElementById('go-to-create-btn').addEventListener('click', () => {
                if (!userId) { showAlert('Firebaseに接続できていません。設定を確認してください。'); return; }
                showScreen('create-screen');
                document.getElementById('quiz-title-input').value = '';
                document.getElementById('questions-container').innerHTML = '';
                addQuestionForm();
            });
            document.getElementById('back-to-home-from-create').addEventListener('click', () => showScreen('home-screen'));
            document.getElementById('back-to-home-from-play').addEventListener('click', () => showScreen('home-screen'));
            document.getElementById('add-question-btn').addEventListener('click', addQuestionForm);
            document.getElementById('save-quiz-btn').addEventListener('click', saveQuiz);
            // --- 修正点：削除ボタンのリスナーを追加 ---
            document.getElementById('delete-quiz-btn').addEventListener('click', deleteQuiz);
            document.getElementById('start-quiz-btn').addEventListener('click', startQuiz);
            document.getElementById('edit-quiz-btn').addEventListener('click', editQuiz);
            document.getElementById('choice-a-btn').addEventListener('click', handleChoice);
            document.getElementById('choice-b-btn').addEventListener('click', handleChoice);
            document.getElementById('next-question-btn').addEventListener('click', nextQuestion);
            
            document.getElementById('questions-container').addEventListener('input', (e) => {
                if (e.target.classList.contains('url-input')) {
                    const input = e.target;
                    const previewImg = input.nextElementSibling;
                    const url = input.value;
                    
                    previewImg.src = url || 'https://placehold.co/64x64/f3f4f6/f3f4f6?text=.';

                    previewImg.onerror = () => {
                        previewImg.src = 'https://placehold.co/64x64/fecaca/991b1b?text=Error';
                    };
                }
            });

            document.getElementById('questions-container').addEventListener('click', (e) => {
                if (e.target.classList.contains('delete-question-btn')) {
                    const questionForm = e.target.closest('.question-form');
                    if (questionForm) {
                        questionForm.remove();
                        renumberQuestions();
                    }
                }
            });
        }

        function renumberQuestions() {
            const questionForms = document.querySelectorAll('.question-form');
            questionForms.forEach((form, index) => {
                const questionCount = index + 1;
                form.querySelector('h3').textContent = `問題 ${questionCount}`;
                
                const radioInputs = form.querySelectorAll('input[type="radio"]');
                radioInputs.forEach(radio => {
                    const originalId = radio.id;
                    const choice = originalId.split('-')[0];
                    const newId = `${choice}-${questionCount}`;
                    
                    radio.name = `correct-answer-${questionCount}`;
                    radio.id = newId;

                    const label = form.querySelector(`label[for="${originalId}"]`);
                    if (label) {
                        label.htmlFor = newId;
                    }
                });
            });
        }


        // --- クイズ作成 ---
        function addQuestionForm() {
            const container = document.getElementById('questions-container');
            const questionCount = container.children.length + 1;
            const formHtml = `
                <div class="question-form bg-gray-50 p-6 rounded-lg border-2 border-dashed">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-xl font-bold text-gray-700">問題 ${questionCount}</h3>
                        <button type="button" class="delete-question-btn bg-gray-200 text-gray-600 text-xs font-medium py-1 px-2 rounded-md hover:bg-gray-300 hover:text-gray-800 transition duration-300">削除</button>
                    </div>
                    <div class="space-y-4">
                        <div class="flex items-center space-x-2">
                           <input type="text" class="question-image-url w-full p-2 border rounded url-input" placeholder="画像の直接リンク (.jpg/.png) を入力">
                           <img src="https://placehold.co/64x64/f3f4f6/f3f4f6?text=." alt="プレビュー" class="form-image-preview">
                        </div>
                        <textarea class="question-text w-full p-2 border rounded" placeholder="問題文"></textarea>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div class="choice-section bg-white p-4 rounded border">
                                <p class="font-bold mb-2">選択肢 A</p>
                                <div class="flex items-center space-x-2">
                                    <input type="text" class="choice-a-image-url w-full p-2 border rounded url-input" placeholder="選択肢Aの画像直接リンク">
                                    <img src="https://placehold.co/64x64/f3f4f6/f3f4f6?text=." alt="プレビュー" class="form-image-preview">
                                </div>
                                <input type="text" class="choice-a-text w-full p-2 border rounded mt-2" placeholder="選択肢Aのテキスト">
                            </div>
                            <div class="choice-section bg-white p-4 rounded border">
                                <p class="font-bold mb-2">選択肢 B</p>
                                <div class="flex items-center space-x-2">
                                    <input type="text" class="choice-b-image-url w-full p-2 border rounded url-input" placeholder="選択肢Bの画像直接リンク">
                                    <img src="https://placehold.co/64x64/f3f4f6/f3f4f6?text=." alt="プレビュー" class="form-image-preview">
                                </div>
                                <input type="text" class="choice-b-text w-full p-2 border rounded mt-2" placeholder="選択肢Bのテキスト">
                            </div>
                        </div>
                        <div class="text-center mt-2">
                            <p class="font-bold mb-2">正解は？</p>
                            <div class="inline-flex rounded-md shadow-sm">
                                <input type="radio" name="correct-answer-${questionCount}" value="A" class="hidden peer/a" id="a-${questionCount}" checked><label for="a-${questionCount}" class="px-4 py-2 text-sm font-medium text-gray-900 bg-white border border-gray-200 rounded-l-lg cursor-pointer peer-checked/a:bg-blue-500 peer-checked/a:text-white hover:bg-gray-100">A</label>
                                <input type="radio" name="correct-answer-${questionCount}" value="B" class="hidden peer/b" id="b-${questionCount}"><label for="b-${questionCount}" class="px-4 py-2 text-sm font-medium text-gray-900 bg-white border border-gray-200 rounded-r-md cursor-pointer peer-checked/b:bg-blue-500 peer-checked/b:text-white hover:bg-gray-100">B</label>
                            </div>
                        </div>
                    </div>
                </div>`;
            container.insertAdjacentHTML('beforeend', formHtml);
        }
        
        async function saveQuiz() {
            if (!userId) { showAlert('Firebaseに接続できていません。設定を確認してください。'); return; }
            const title = document.getElementById('quiz-title-input').value.trim();
            if (!title) { showAlert('クイズのタイトルを入力してください。'); return; }
            const questionForms = document.querySelectorAll('.question-form');
            if (questionForms.length === 0) { showAlert('最低1問は問題を作成してください。'); return; }
            
            showLoader(true);
            try {
                const newQuizData = Array.from(questionForms).map((form, index) => {
                    const questionText = form.querySelector('.question-text').value.trim();
                    const choiceAText = form.querySelector('.choice-a-text').value.trim();
                    const choiceBText = form.querySelector('.choice-b-text').value.trim();
                    if (!questionText || !choiceAText || !choiceBText) {
                        throw new Error(`問題${index + 1}のテキストが入力されていません。`);
                    }
                    return {
                        questionImage: form.querySelector('.question-image-url').value.trim(),
                        questionText,
                        choiceAImage: form.querySelector('.choice-a-image-url').value.trim(),
                        choiceAText,
                        choiceBImage: form.querySelector('.choice-b-image-url').value.trim(),
                        choiceBText,
                        correctAnswer: form.querySelector(`input[name^="correct-answer-"]:checked`).value
                    };
                });

                const quizDoc = { title, questions: newQuizData, author: userId, createdAt: new Date() };
                const quizzesCol = collection(db, "artifacts", appId, "public", "data", "quizzes");
                await setDoc(doc(quizzesCol, title), quizDoc);

                showAlert(`クイズ「${title}」を保存しました！`);
                showScreen('home-screen');
            } catch (error) {
                showAlert(`保存エラー: ${error.message}`);
            } finally {
                showLoader(false);
            }
        }
        
        // --- 修正点：クイズ削除機能を追加 ---
        async function deleteQuiz() {
            if (!userId) { showAlert('Firebaseに接続できていません。設定を確認してください。'); return; }
            const title = document.getElementById('quiz-title-input').value.trim();
            if (!title) {
                showAlert('削除するクイズのタイトルがありません。\nタイトルを入力して削除してください。');
                return;
            }

            // 本当に削除してよいか確認する機能は、標準のconfirmが使えないため、カスタムアラートで実装する必要があります。
            // ここでは簡易的に、即時削除とします。

            showLoader(true);
            try {
                const quizzesCol = collection(db, "artifacts", appId, "public", "data", "quizzes");
                const quizDocRef = doc(quizzesCol, title);

                // Firestoreからドキュメントを削除
                await deleteDoc(quizDocRef);

                showAlert(`クイズ「${title}」を削除しました。`);
                showScreen('home-screen');
                // 各入力欄をクリア
                document.getElementById('quiz-name-input').value = '';
                document.getElementById('quiz-title-input').value = '';
                document.getElementById('questions-container').innerHTML = '';

            } catch (error) {
                console.error("Error deleting quiz: ", error);
                showAlert(`削除中にエラーが発生しました: ${error.message}`);
            } finally {
                showLoader(false);
            }
        }

        async function editQuiz() {
            if (!userId) { showAlert('Firebaseに接続できていません。設定を確認してください。'); return; }
            const quizName = document.getElementById('quiz-name-input').value.trim();
            if (!quizName) { showAlert('編集するクイズ名を入力してください。'); return; }

            showLoader(true);
            try {
                const quizzesCol = collection(db, "artifacts", appId, "public", "data", "quizzes");
                const q = query(quizzesCol, where("title", "==", quizName));
                const querySnapshot = await getDocs(q);

                if (querySnapshot.empty) {
                    showAlert('その名前のクイズは見つかりませんでした。');
                } else {
                    const quizDoc = querySnapshot.docs[0].data();
                    populateCreateScreen(quizDoc);
                    showScreen('create-screen');
                }
            } catch (error) {
                showAlert("クイズの読み込み中にエラーが発生しました。");
            } finally {
                showLoader(false);
            }
        }

        function populateCreateScreen(quizData) {
            document.getElementById('quiz-title-input').value = quizData.title;
            const container = document.getElementById('questions-container');
            container.innerHTML = ''; 

            quizData.questions.forEach((question, index) => {
                addQuestionForm();
                const questionForms = document.querySelectorAll('.question-form');
                const form = questionForms[index]; 

                form.querySelector('.question-image-url').value = question.questionImage || '';
                form.querySelector('.question-text').value = question.questionText || '';
                form.querySelector('.choice-a-image-url').value = question.choiceAImage || '';
                form.querySelector('.choice-a-text').value = question.choiceAText || '';
                form.querySelector('.choice-b-image-url').value = question.choiceBImage || '';
                form.querySelector('.choice-b-text').value = question.choiceBText || '';
                
                const radio = form.querySelector(`input[value="${question.correctAnswer}"]`);
                if (radio) radio.checked = true;

                // 画像プレビューを更新
                form.querySelectorAll('.url-input').forEach(input => {
                    const previewImg = input.nextElementSibling;
                    const url = input.value;
                    if (url) {
                       previewImg.src = url;
                       previewImg.onerror = () => {
                           previewImg.src = 'https://placehold.co/64x64/fecaca/991b1b?text=Error';
                       };
                    }
                });
            });
        }
        
        // --- クイズ実行 ---
        async function startQuiz() {
            if (!userId) { showAlert('Firebaseに接続できていません。設定を確認してください。'); return; }
            const quizName = document.getElementById('quiz-name-input').value.trim();
            if (!quizName) { showAlert('クイズ名を入力してください。'); return; }

            showLoader(true);
            try {
                const quizzesCol = collection(db, "artifacts", appId, "public", "data", "quizzes");
                const q = query(quizzesCol, where("title", "==", quizName));
                const querySnapshot = await getDocs(q);

                if (querySnapshot.empty) {
                    showAlert('その名前のクイズは見つかりませんでした。');
                } else {
                    const quizDoc = querySnapshot.docs[0].data();
                    currentQuiz = quizDoc.questions;
                    currentQuestionIndex = 0;
                    displayQuestion();
                    showScreen('play-screen');
                }
            } catch (error) {
                showAlert("クイズの読み込み中にエラーが発生しました。");
            } finally {
                showLoader(false);
            }
        }
        
        function displayQuestion() {
            const question = currentQuiz[currentQuestionIndex];
            const quizName = document.getElementById('quiz-name-input').value.trim();
            document.getElementById('quiz-title-display').textContent = `${quizName} (${currentQuestionIndex + 1}/${currentQuiz.length})`;

            const qImg = document.getElementById('question-image');
            const aImg = document.getElementById('choice-a-image');
            const bImg = document.getElementById('choice-b-image');
            
            qImg.src = question.questionImage;
            qImg.style.display = question.questionImage ? 'block' : 'none';

            document.getElementById('question-text').textContent = question.questionText;

            aImg.src = question.choiceAImage;
            aImg.style.display = question.choiceAImage ? 'block' : 'none';
            document.getElementById('choice-a-text').textContent = question.choiceAText;
            
            bImg.src = question.choiceBImage;
            bImg.style.display = question.choiceBImage ? 'block' : 'none';
            document.getElementById('choice-b-text').textContent = question.choiceBText;

            [document.getElementById('choice-a-btn'), document.getElementById('choice-b-btn')].forEach(btn => {
                btn.disabled = false;
                btn.classList.remove('correct', 'incorrect');
            });
            document.getElementById('result-message').textContent = '';
            document.getElementById('next-question-btn').classList.add('hidden');
        }

        function handleChoice(e) {
            const selectedButton = e.currentTarget;
            const selectedChoice = selectedButton.dataset.choice;
            const question = currentQuiz[currentQuestionIndex];

            document.getElementById('choice-a-btn').disabled = true;
            document.getElementById('choice-b-btn').disabled = true;

            const resultMsg = document.getElementById('result-message');
            const correctBtnId = question.correctAnswer === 'A' ? 'choice-a-btn' : 'choice-b-btn';
            
            if (selectedChoice === question.correctAnswer) {
                resultMsg.textContent = "正解！";
                resultMsg.style.color = '#16a34a'; // green-600
                selectedButton.classList.add('correct');
            } else {
                resultMsg.textContent = "ざんねん…";
                resultMsg.style.color = '#ea580c'; // orange-600
                selectedButton.classList.add('incorrect');
                // 不正解の時に正解の選択肢を緑枠で表示
                document.getElementById(correctBtnId).classList.add('correct');
            }
            const nextBtn = document.getElementById('next-question-btn');
            nextBtn.textContent = (currentQuestionIndex < currentQuiz.length - 1) ? '次の問題へ' : 'クイズ終了';
            nextBtn.classList.remove('hidden');
        }

        function nextQuestion() {
            currentQuestionIndex++;
            if (currentQuestionIndex < currentQuiz.length) {
                displayQuestion();
            } else {
                showAlert('クイズ終了です！お疲れ様でした。');
                showScreen('home-screen');
            }
        }
    </script>
</body>
</html>

